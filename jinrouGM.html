<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>äººç‹¼GMãƒ„ãƒ¼ãƒ« å®Œå…¨ç‰ˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: #fafafa;
    color: #222;
    margin: 20px;
  }
  h1, h2, h3 {
    text-align: center;
  }
  .card {
    background: #fff;
    max-width: 900px;
    margin: 15px auto;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px #ccc;
  }
  button {
    padding: 8px 15px;
    margin: 5px;
    font-size: 15px;
    border-radius: 6px;
    border: none;
    background: #448aff;
    color: white;
    cursor: pointer;
  }
  button:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  input, select {
    font-size: 14px;
    padding: 5px;
    margin: 5px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #bbb;
    padding: 6px 10px;
    text-align: center;
  }
  th {
    background: #eee;
  }
  .hidden {
    display: none;
  }
  #resetButton {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #e53935;
  }
  #discussionTimer, #voteResult, #runoffVoteResult, #nightResult, #morningResult {
    font-weight: bold;
    margin-top: 12px;
    font-size: 1.1em;
    text-align: center;
  }
</style>
</head>
<body>
<button id="resetButton">ğŸ”„ ã‚²ãƒ¼ãƒ åˆæœŸåŒ–</button>
<h1>äººç‹¼GMãƒ„ãƒ¼ãƒ« å®Œå…¨ç‰ˆ</h1>
<div id="game"></div>

<script>
(() => {
  const ROLE_LIST = ["äººç‹¼", "è£åˆ‡è€…", "å ã„å¸«", "ç‹©äºº", "éœŠåª’å¸«", "æ‘äºº"];
  let players = {};
  let phase = "æº–å‚™";
  let dayCount = 1;
  let useManualRoleSelect = false;

  const gameDiv = document.getElementById("game");
  const resetBtn = document.getElementById("resetButton");

  // åˆæœŸåŒ–è¡¨ç¤º
  function init() {
    gameDiv.innerHTML = `
      <div class="card" id="setupPhase">
        <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­å®š</h2>
        <label>äººæ•°ï¼š
          <input type="number" id="playerCountInput" min="3" max="15" value="6" />
        </label>
        <button id="createNameInputsBtn">åå‰å…¥åŠ›æ¬„ã‚’ä½œæˆ</button>
        <div id="nameInputsArea"></div>

        <h3>å½¹è·é…å¸ƒæ–¹æ³•ã‚’é¸æŠ</h3>
        <label><input type="radio" name="roleSelectMethod" value="random" checked> ãƒ©ãƒ³ãƒ€ãƒ é…å¸ƒ</label>
        <label><input type="radio" name="roleSelectMethod" value="manual"> æ‰‹å‹•è¨­å®š</label>

        <button id="assignRolesBtn" disabled>å½¹è·ã‚’é…å¸ƒã—ã¦é–‹å§‹</button>
      </div>
      <div id="manualRoleSelectArea" class="card hidden">
        <h3>æ‰‹å‹•ã§å½¹è·ã‚’å‰²ã‚Šå½“ã¦ã‚‹</h3>
        <div id="manualRoleInputs"></div>
        <button id="startGameBtn" disabled>ã‚²ãƒ¼ãƒ é–‹å§‹</button>
      </div>
    `;

    document.getElementById("createNameInputsBtn").onclick = createNameInputs;
    document.getElementsByName("roleSelectMethod").forEach(radio => {
      radio.onchange = () => {
        useManualRoleSelect = document.querySelector('input[name="roleSelectMethod"]:checked').value === "manual";
        document.getElementById("assignRolesBtn").disabled = false;
        document.getElementById("manualRoleSelectArea").classList.toggle("hidden", !useManualRoleSelect);
      };
    });
    document.getElementById("assignRolesBtn").onclick = assignRoles;
  }

  // åå‰å…¥åŠ›æ¬„ä½œæˆ
  function createNameInputs() {
    const count = Number(document.getElementById("playerCountInput").value);
    if (count < 3 || count > 15) {
      alert("äººæ•°ã¯3ã€œ15äººã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }
    const area = document.getElementById("nameInputsArea");
    area.innerHTML = "";
    for (let i = 0; i < count; i++) {
      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i + 1}ã®åå‰`;
      input.className = "playerNameInput";
      input.style.margin = "4px";
      area.appendChild(input);
    }
    document.getElementById("assignRolesBtn").disabled = false;
  }

  // å½¹è·å‰²ã‚Šå½“ã¦
  function assignRoles() {
    const inputs = document.querySelectorAll(".playerNameInput");
    const names = Array.from(inputs).map(i => i.value.trim()).filter(n => n);
    if (names.length < 3) {
      alert("3äººä»¥ä¸Šã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    players = {};
    dayCount = 1;
    phase = "æ˜¼";

    if (!useManualRoleSelect) {
      // ãƒ©ãƒ³ãƒ€ãƒ é…å¸ƒ
      let rolesForGame = [];
      rolesForGame.push("äººç‹¼", "è£åˆ‡è€…", "å ã„å¸«", "ç‹©äºº", "éœŠåª’å¸«");
      while (rolesForGame.length < names.length) rolesForGame.push("æ‘äºº");
      shuffle(rolesForGame);
      names.forEach((name, i) => {
        players[name] = { role: rolesForGame[i], alive: true, protect: false };
      });
      startGame();
    } else {
      buildManualRoleInputs(names);
      document.getElementById("assignRolesBtn").disabled = true;
    }
  }

  // æ‰‹å‹•å‰²å½“UIä½œæˆ
  function buildManualRoleInputs(names) {
    const container = document.getElementById("manualRoleInputs");
    container.innerHTML = "";
    names.forEach(name => {
      const div = document.createElement("div");
      div.style.marginBottom = "8px";
      const labelName = document.createElement("span");
      labelName.textContent = name + " ï¼š ";
      div.appendChild(labelName);

      const selectRole = document.createElement("select");
      ROLE_LIST.forEach(role => {
        const opt = document.createElement("option");
        opt.value = role;
        opt.textContent = role;
        selectRole.appendChild(opt);
      });
      div.appendChild(selectRole);
      container.appendChild(div);
    });

    const startBtn = document.getElementById("startGameBtn");
    startBtn.disabled = false;
    startBtn.onclick = () => {
      players = {};
      const selects = container.querySelectorAll("select");
      names.forEach((name, i) => {
        players[name] = { role: selects[i].value, alive: true, protect: false };
      });
      phase = "æ˜¼";
      dayCount = 1;
      document.getElementById("setupPhase").classList.add("hidden");
      document.getElementById("manualRoleSelectArea").classList.add("hidden");
      startGame();
    };
  }

  // ã‚²ãƒ¼ãƒ é–‹å§‹
  function startGame() {
    saveData();
    showMainUI();
  }

  // ãƒ¡ã‚¤ãƒ³UIè¡¨ç¤º
  function showMainUI() {
    gameDiv.innerHTML = `
      <div class="card" id="statusArea">
        <h2>ãƒ•ã‚§ãƒ¼ã‚ºï¼š<span id="phaseLabel">${phase}</span>ã€€æ—¥æ•°ï¼š<span id="dayLabel">${dayCount}</span>æ—¥ç›®</h2>
      </div>

      <div class="card" id="playerStatusArea">
        <h3>ç”Ÿå­˜è€…ä¸€è¦§</h3>
        <div id="aliveList"></div>
        <h3>è¿½æ”¾ãƒ»æ­»äº¡è€…ä¸€è¦§</h3>
        <div id="deadList"></div>
      </div>

      <div class="card" id="discussionPhase" ${phase !== "æ˜¼" ? 'style="display:none;"' : ''}>
        <h3>è­°è«–ãƒ•ã‚§ãƒ¼ã‚º</h3>
        <label>æ™‚é–“ï¼ˆåˆ†ï¼‰: <input type="number" id="discussionTime" value="3" min="1" max="10" style="width:50px;"></label>
        <button id="startDiscussionBtn">è­°è«–é–‹å§‹</button>
        <div id="discussionTimer"></div>
      </div>

      <div class="card" id="votingPhase" style="display:none;">
        <h3>æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚º</h3>
        <table id="voteTable">
          <thead><tr><th>æŠ•ç¥¨è€…</th><th>æŠ•ç¥¨å…ˆ</th></tr></thead>
          <tbody></tbody>
        </table>
        <button id="tallyVotesBtn">æŠ•ç¥¨é›†è¨ˆ</button>
        <div id="voteResult"></div>
      </div>

      <div class="card hidden" id="runoffPhase">
        <h3>æ±ºé¸æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚º</h3>
        <p id="runoffCandidates"></p>
        <table id="runoffVoteTable">
          <thead><tr><th>æŠ•ç¥¨è€…</th><th>æŠ•ç¥¨å…ˆ</th></tr></thead>
          <tbody></tbody>
        </table>
        <button id="runoffTallyBtn">æ±ºé¸æŠ•ç¥¨é›†è¨ˆ</button>
        <div id="runoffVoteResult"></div>
      </div>

      <div class="card hidden" id="nightPhase">
        <h3>å¤œã®ãƒ•ã‚§ãƒ¼ã‚º</h3>
        <p>äººç‹¼ã¯è¥²æ’ƒã™ã‚‹å¯¾è±¡ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
        <label>äººç‹¼è¥²æ’ƒå¯¾è±¡ï¼š
          <select id="werewolfTargetSelect"></select>
        </label>
        <p>ç‹©äººã¯å®ˆã‚‹å¯¾è±¡ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
        <label>ç‹©äººè­·è¡›å¯¾è±¡ï¼š
          <select id="hunterProtectSelect"></select>
        </label>
        <p>å ã„å¸«ã¯å ã†å¯¾è±¡ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
        <label>å ã„å¯¾è±¡ï¼š
          <select id="seerSelect"></select>
        </label>
        <button id="submitNightActionBtn">å¤œã®è¡Œå‹•æ±ºå®š</button>
        <div id="nightResult"></div>
      </div>

      <div class="card hidden" id="morningPhase">
        <h3>æœã®çµæœç™ºè¡¨</h3>
        <div id="morningResult"></div>
        <button id="nextDayBtn">æ¬¡ã®æ—¥ã¸</button>
      </div>
    `;

    updatePlayerLists();
    setupDiscussionPhase();
  }

  // ç”Ÿå­˜è€…ãƒ»æ­»äº¡è€…ä¸€è¦§æ›´æ–°
  function updatePlayerLists() {
    const aliveList = document.getElementById("aliveList");
    const deadList = document.getElementById("deadList");
    aliveList.innerHTML = "";
    deadList.innerHTML = "";
    Object.entries(players).forEach(([name, p]) => {
      const text = `${name}ï¼ˆ${p.role}ï¼‰`;
      if (p.alive) {
        aliveList.innerHTML += text + "<br>";
      } else {
        deadList.innerHTML += text + "<br>";
      }
    });
  }

  // è­°è«–ãƒ•ã‚§ãƒ¼ã‚ºã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  function setupDiscussionPhase() {
    const startBtn = document.getElementById("startDiscussionBtn");
    const timerDiv = document.getElementById("discussionTimer");
    let timerId = null;
    let timeLeft = 0;

    startBtn.onclick = () => {
      const time = Number(document.getElementById("discussionTime").value);
      if (time <= 0) {
        alert("1åˆ†ä»¥ä¸Šã§è¨­å®šã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      startBtn.disabled = true;
      timeLeft = time * 60;
      timerDiv.textContent = formatTime(timeLeft);
      timerId = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(timerId);
          timerDiv.textContent = "è­°è«–çµ‚äº†ï¼";
          startBtn.disabled = false;
          showVotingPhase();
        } else {
          timerDiv.textContent = formatTime(timeLeft);
        }
      }, 1000);
    };
  }

  // æ™‚é–“è¡¨ç¤º mm:ss
  function formatTime(sec) {
    const m = String(Math.floor(sec / 60)).padStart(2, "0");
    const s = String(sec % 60).padStart(2, "0");
    return `${m}:${s}`;
  }

  // æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚ºè¡¨ç¤º
  function showVotingPhase() {
    document.getElementById("discussionPhase").style.display = "none";
    document.getElementById("votingPhase").style.display = "block";
    document.getElementById("runoffPhase").classList.add("hidden");
    document.getElementById("nightPhase").classList.add("hidden");
    document.getElementById("morningPhase").classList.add("hidden");

    const tbody = document.querySelector("#voteTable tbody");
    tbody.innerHTML = "";
    const alivePlayers = Object.entries(players).filter(([_, p]) => p.alive).map(([name]) => name);

    alivePlayers.forEach(voter => {
      const tr = document.createElement("tr");
      const tdVoter = document.createElement("td");
      tdVoter.textContent = `${voter}ï¼ˆ${players[voter].role}ï¼‰`;
      const tdVote = document.createElement("td");
      const select = document.createElement("select");
      alivePlayers.forEach(name => {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = `${name}ï¼ˆ${players[name].role}ï¼‰`;
        select.appendChild(option);
      });
      tdVote.appendChild(select);
      tr.appendChild(tdVoter);
      tr.appendChild(tdVote);
      tbody.appendChild(tr);
    });

    document.getElementById("tallyVotesBtn").onclick = tallyVotes;
  }

  // æŠ•ç¥¨é›†è¨ˆ
  function tallyVotes() {
    const tbody = document.querySelector("#voteTable tbody");
    const votes = {};
    for (const tr of tbody.querySelectorAll("tr")) {
      const voteTarget = tr.children[1].querySelector("select").value;
      votes[voteTarget] = (votes[voteTarget] || 0) + 1;
    }

    const maxVote = Math.max(...Object.values(votes));
    const topCandidates = Object.entries(votes).filter(([_, v]) => v === maxVote).map(([n]) => n);

    if (topCandidates.length === 1) {
      eliminatePlayer(topCandidates[0]);
      document.getElementById("voteResult").textContent = `${topCandidates[0]} ãŒè¿½æ”¾ã•ã‚Œã¾ã—ãŸã€‚`;
      phase = "å¤œ";
      dayCountLabelUpdate();
      setTimeout(startNightPhase, 2000);
    } else {
      document.getElementById("voteResult").textContent = "åŒç¥¨ã§ã™ã€‚æ±ºé¸æŠ•ç¥¨ã‚’è¡Œã„ã¾ã™ã€‚";
      startRunoffVote(topCandidates);
    }
  }

  // æ±ºé¸æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹
  function startRunoffVote(candidates) {
    document.getElementById("votingPhase").style.display = "none";
    const runoff = document.getElementById("runoffPhase");
    runoff.classList.remove("hidden");
    document.getElementById("nightPhase").classList.add("hidden");
    document.getElementById("morningPhase").classList.add("hidden");

    document.getElementById("runoffCandidates").textContent = `å€™è£œè€…: ${candidates.map(c => `${c}ï¼ˆ${players[c].role}ï¼‰`).join(", ")}`;

    const tbody = document.querySelector("#runoffVoteTable tbody");
    tbody.innerHTML = "";

    const runoffVoters = Object.entries(players).filter(([name, p]) => p.alive && !candidates.includes(name)).map(([name]) => name);

    runoffVoters.forEach(voter => {
      const tr = document.createElement("tr");
      const tdVoter = document.createElement("td");
      tdVoter.textContent = `${voter}ï¼ˆ${players[voter].role}ï¼‰`;
      const tdVote = document.createElement("td");
      const select = document.createElement("select");
      candidates.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = `${c}ï¼ˆ${players[c].role}ï¼‰`;
        select.appendChild(opt);
      });
      tdVote.appendChild(select);
      tr.appendChild(tdVoter);
      tr.appendChild(tdVote);
      tbody.appendChild(tr);
    });

    document.getElementById("runoffTallyBtn").onclick = () => {
      const votes = {};
      for (const tr of tbody.querySelectorAll("tr")) {
        const voteTarget = tr.children[1].querySelector("select").value;
        votes[voteTarget] = (votes[voteTarget] || 0) + 1;
      }
      const maxVote = Math.max(...Object.values(votes));
      const topCandidates = Object.entries(votes).filter(([_, v]) => v === maxVote).map(([n]) => n);

      if (topCandidates.length === 1) {
        eliminatePlayer(topCandidates[0]);
        document.getElementById("runoffVoteResult").textContent = `${topCandidates[0]} ãŒè¿½æ”¾ã•ã‚Œã¾ã—ãŸã€‚`;
        phase = "å¤œ";
        dayCountLabelUpdate();
        setTimeout(startNightPhase, 2000);
      } else {
        // ãã‚Œã§ã‚‚åŒç¥¨ãªã‚‰ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ
        runRoulette(topCandidates);
      }
    };
  }

  // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæ±ºå®š
  function runRoulette(candidates) {
    const resultDiv = document.getElementById("runoffVoteResult");
    resultDiv.textContent = "ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã§æ±ºå®šä¸­...";
    let idx = 0;
    const interval = setInterval(() => {
      resultDiv.textContent = `ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆé¸æŠä¸­ï¼š${candidates[idx]}ï¼ˆ${players[candidates[idx]].role}ï¼‰`;
      idx = (idx + 1) % candidates.length;
    }, 150);

    setTimeout(() => {
      clearInterval(interval);
      const choice = candidates[Math.floor(Math.random() * candidates.length)];
      eliminatePlayer(choice);
      resultDiv.textContent = `ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã§ ${choice} ãŒè¿½æ”¾ã•ã‚Œã¾ã—ãŸã€‚`;
      phase = "å¤œ";
      dayCountLabelUpdate();
      setTimeout(startNightPhase, 2000);
    }, 4000);
  }

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½æ”¾å‡¦ç†
  function eliminatePlayer(name) {
    if (!players[name]) return;
    players[name].alive = false;
    saveData();
    updatePlayerLists();
  }

  // æ—¥æ•°ãƒ©ãƒ™ãƒ«æ›´æ–°
  function dayCountLabelUpdate() {
    document.getElementById("dayLabel").textContent = dayCount;
    document.getElementById("phaseLabel").textContent = phase;
  }

  // å¤œãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹
  function startNightPhase() {
    phase = "å¤œ";
    dayCountLabelUpdate();

    document.getElementById("discussionPhase").style.display = "none";
    document.getElementById("votingPhase").style.display = "none";
    document.getElementById("runoffPhase").classList.add("hidden");
    document.getElementById("nightPhase").classList.remove("hidden");
    document.getElementById("morningPhase").classList.add("hidden");

    // å¤œã®å¯¾è±¡é¸æŠè‚¢ã‚»ãƒƒãƒˆ
    const aliveNames = Object.entries(players).filter(([_, p]) => p.alive).map(([n]) => n);
    const werewolfTarget = document.getElementById("werewolfTargetSelect");
    const hunterProtect = document.getElementById("hunterProtectSelect");
    const seerSelect = document.getElementById("seerSelect");

    werewolfTarget.innerHTML = "";
    hunterProtect.innerHTML = "";
    seerSelect.innerHTML = "";

    aliveNames.forEach(name => {
      const opt1 = document.createElement("option");
      opt1.value = name;
      opt1.textContent = `${name}ï¼ˆ${players[name].role}ï¼‰`;
      werewolfTarget.appendChild(opt1);

      const opt2 = document.createElement("option");
      opt2.value = name;
      opt2.textContent = `${name}ï¼ˆ${players[name].role}ï¼‰`;
      hunterProtect.appendChild(opt2);

      const opt3 = document.createElement("option");
      opt3.value = name;
      opt3.textContent = `${name}ï¼ˆ${players[name].role}ï¼‰`;
      seerSelect.appendChild(opt3);
    });

    document.getElementById("submitNightActionBtn").onclick = submitNightActions;
    document.getElementById("nightResult").textContent = "";
  }

  // å¤œã®è¡Œå‹•ç¢ºå®šå‡¦ç†
  function submitNightActions() {
    const werewolfTarget = document.getElementById("werewolfTargetSelect").value;
    const hunterProtectTarget = document.getElementById("hunterProtectSelect").value;
    const seerTarget = document.getElementById("seerSelect").value;

    // è¥²æ’ƒåˆ¤å®š
    let attackedPlayer = werewolfTarget;
    if (hunterProtectTarget === attackedPlayer) {
      attackedPlayer = null; // ç‹©äººãŒå®ˆã£ãŸ
    }

    // å ã„çµæœåˆ¤å®š
    let seerResult = "";
    if (players[seerTarget].role === "äººç‹¼" || players[seerTarget].role === "è£åˆ‡è€…") {
      seerResult = `${seerTarget} ã¯ äººç‹¼é™£å–¶ ã§ã™ã€‚`;
    } else {
      seerResult = `${seerTarget} ã¯ æ‘äººé™£å–¶ ã§ã™ã€‚`;
    }

    // è¥²æ’ƒæ­»äº¡åæ˜ 
    if (attackedPlayer) {
      players[attackedPlayer].alive = false;
    }

    saveData();
    updatePlayerLists();

    // éœŠåª’å¸«å‡¦ç†ï¼šç›´å‰ã«è¿½æ”¾ã•ã‚ŒãŸäººã®å½¹è·è¡¨ç¤º
    // ã“ã“ã§ã¯è¿½æ”¾ç›´å‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’localStorageã‹å¤‰æ•°ã§ç®¡ç†ã—ã¦ã„ã‚‹ãŒã€ä»Šå›ã¯ç›´å‰è¿½æ”¾ã¯æŠ•ç¥¨å‡¦ç†æ™‚ã«ä¿å­˜ã™ã‚‹å½¢ã§å¯¾å¿œ
    let lastExecuted = localStorage.getItem("lastExecuted") || null;
    let mediumResult = "";
    if (lastExecuted && players[lastExecuted]) {
      mediumResult = `${lastExecuted} ã®å½¹è·ã¯ ${players[lastExecuted].role} ã§ã—ãŸã€‚`;
    } else {
      mediumResult = "éœŠåª’å¸«æƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
    }

    // å¤œã®çµæœè¡¨ç¤º
    let nightResultText = "";
    if (attackedPlayer) {
      nightResultText = `è¥²æ’ƒã•ã‚ŒãŸã®ã¯ ${attackedPlayer} ã§ã™ã€‚<br>`;
    } else {
      nightResultText = `è¥²æ’ƒã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>`;
    }
    nightResultText += `${seerResult}<br>${mediumResult}`;

    document.getElementById("nightResult").innerHTML = nightResultText;

    phase = "æœ";
    dayCountLabelUpdate();

    // å¤œã®è¡¨ç¤ºã‹ã‚‰æœã®è¡¨ç¤ºã¸
    setTimeout(() => {
      document.getElementById("nightPhase").classList.add("hidden");
      document.getElementById("morningPhase").classList.remove("hidden");
      showMorningResult(attackedPlayer);
    }, 4000);
  }

  // æœã®çµæœè¡¨ç¤º
  function showMorningResult(killedPlayer) {
    const morningResult = document.getElementById("morningResult");
    let text = "";
    if (killedPlayer) {
      text += `å¤œã®è¥²æ’ƒã§ <strong>${killedPlayer}</strong> ãŒæ­»äº¡ã—ã¾ã—ãŸã€‚<br>`;
    } else {
      text += "å¤œã®è¥²æ’ƒã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>";
    }
    morningResult.innerHTML = text;

    // æ¬¡ã®æ—¥ã¸ãƒœã‚¿ãƒ³ã®è¨­å®š
    document.getElementById("nextDayBtn").onclick = () => {
      dayCount++;
      phase = "æ˜¼";
      saveData();
      updatePlayerLists();
      dayCountLabelUpdate();
      showMainUI();
    };
  }

  // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
  function saveData() {
    localStorage.setItem("players", JSON.stringify(players));
    localStorage.setItem("phase", phase);
    localStorage.setItem("dayCount", dayCount);
  }

  // ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
  function loadData() {
    const storedPlayers = localStorage.getItem("players");
    const storedPhase = localStorage.getItem("phase");
    const storedDayCount = localStorage.getItem("dayCount");
    if (storedPlayers && storedPhase && storedDayCount) {
      players = JSON.parse(storedPlayers);
      phase = storedPhase;
      dayCount = Number(storedDayCount);
      return true;
    }
    return false;
  }

  // ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  // åˆæœŸåŒ–
  resetBtn.onclick = () => {
    if (confirm("ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ")) {
      localStorage.clear();
      location.reload();
    }
  };

  // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚
  window.onload = () => {
    if (!loadData()) {
      init();
    } else {
      showMainUI();
    }
  };
})();
</script>
</body>
</html>